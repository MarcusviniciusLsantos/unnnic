<template>
  <div class="unnnic-text-editor">
    <div class="text-editor" @click="$refs.oDoc.focus()">
      <div
        class="inside"
        contenteditable="true"
        ref="oDoc"
        v-html="initialContent"
        @input="onInput"
        @keydown="$emit('keydown', $event)"
      ></div>

      <div v-if="$slots['footer-input']" class="footer-input" @click.stop>
        <slot name="footer-input" />
      </div>
    </div>

    <div class="actions">
      <unnnic-tool-tip
        side="left"
        :text="text('action')"
        enabled
      >
        <unnnic-button-icon
          @click="$emit('action')"
          type="secondary"
          size="small"
          icon="flash-1-3"
        />
      </unnnic-tool-tip>

      <unnnic-button-icon
        @click="$emit('send')"
        type="primary"
        size="small"
        icon="send-email-3-1"
      />
    </div>

    <div class="format">
      <unnnic-tool-tip
        side="top"
        :text="text('Undo')"
        enabled
      >
        <unnnic-icon
          icon="arrow-undo"
          size="ant"
          clickable
          scheme="neutral-cleanest"
          @click="formatDoc('undo')"
        />
      </unnnic-tool-tip>

      <unnnic-tool-tip
        side="top"
        :text="text('Redo')"
        enabled
      >
        <unnnic-icon
          icon="arrow-redo"
          size="ant"
          clickable
          scheme="neutral-cleanest"
          @click="formatDoc('redo')"
        />
      </unnnic-tool-tip>

      <unnnic-tool-tip
        side="top"
        :text="text('RecordAudio')"
        enabled
      >
        <unnnic-icon
          icon="microphone"
          size="ant"
          clickable
          scheme="neutral-cleanest"
          @mousedown="$emit('record-audio-down')"
          @mouseup="$emit('record-audio-up')"
          @click="$emit('record-audio')"
        />
      </unnnic-tool-tip>

      <unnnic-tool-tip
        side="top"
        :text="text('Attach')"
        :enabled="!attachmentOptionsOpen"
      >
        <unnnic-dropdown
          :open.sync="attachmentOptionsOpen"
          position="none"
          class="attachment-options-dropdown"
        >
          <unnnic-icon
            slot="trigger"
            icon="attachment"
            size="ant"
            clickable
            scheme="neutral-cleanest"
          />

          <div class="attachment-options-container">
            <slot name="attachment-options" />
          </div>
        </unnnic-dropdown>
      </unnnic-tool-tip>

      <!-- <unnnic-icon
        icon="email-action-unread-1"
        size="ant"
        clickable
        scheme="neutral-cleanest"
      /> -->

      <unnnic-tool-tip
        side="top"
        :text="text('Bold')"
        enabled
        :style="{ marginLeft: '1rem', }"
      >
        <unnnic-icon
          icon="text-bold"
          size="ant"
          clickable
          scheme="neutral-cleanest"
          @click="formatDoc('bold')"
        />
      </unnnic-tool-tip>

      <unnnic-tool-tip
        side="top"
        :text="text('Italic')"
        enabled
      >
        <unnnic-icon
          icon="text-italic"
          size="ant"
          clickable
          scheme="neutral-cleanest"
          @click="formatDoc('italic')"
        />
      </unnnic-tool-tip>

      <unnnic-tool-tip
        side="top"
        :text="text('Underline')"
        enabled
      >
        <unnnic-icon
          icon="text-underline"
          size="ant"
          clickable
          scheme="neutral-cleanest"
          @click="formatDoc('underline')"
        />
      </unnnic-tool-tip>

      <unnnic-tool-tip
        side="top"
        :text="text('List')"
        enabled
      >
        <unnnic-icon
          icon="unordered-list"
          size="ant"
          clickable
          scheme="neutral-cleanest"
          @click="formatDoc('insertunorderedlist')"
        />
      </unnnic-tool-tip>

      <unnnic-tool-tip
        side="top"
        :text="text('Left')"
        enabled
      >
        <unnnic-icon
          icon="text-left"
          size="ant"
          clickable
          scheme="neutral-cleanest"
          @click="formatDoc('justifyleft')"
        />
      </unnnic-tool-tip>

      <unnnic-tool-tip
        side="top"
        :text="text('Center')"
        enabled
      >
        <unnnic-icon
          icon="text-center"
          size="ant"
          clickable
          scheme="neutral-cleanest"
          @click="formatDoc('justifycenter')"
        />
      </unnnic-tool-tip>

      <unnnic-tool-tip
        side="top"
        :text="text('Right')"
        enabled
      >
        <unnnic-icon
          icon="text-right"
          size="ant"
          clickable
          scheme="neutral-cleanest"
          @click="formatDoc('justifyright')"
        />
      </unnnic-tool-tip>

      <unnnic-tool-tip
        side="top"
        :text="text('Justify')"
        enabled
      >
        <unnnic-icon
          icon="text-justified"
          size="ant"
          clickable
          scheme="neutral-cleanest"
          @click="formatDoc('justifyFull')"
        />
      </unnnic-tool-tip>
    </div>
  </div>
</template>

<script>
import UnnnicButtonIcon from '../Button/ButtonIcon.vue';
import UnnnicToolTip from '../ToolTip/ToolTip.vue';
import UnnnicIcon from '../Icon.vue';
import UnnnicDropdown from '../Dropdown/Dropdown.vue';

export default {
  components: {
    UnnnicButtonIcon,
    UnnnicToolTip,
    UnnnicIcon,
    UnnnicDropdown,
  },

  props: {
    value: {
      type: String,
      default: '',
    },

    texts: {
      type: Object,
      default() {
        return {
          Undo: 'Undo',
          Redo: 'Redo',
          RecordAudio: 'Record Audio',
          Bold: 'Bold',
          Italic: 'Italic',
          Underline: 'Underline',
          List: 'List',
          Left: 'Left',
          Center: 'Center',
          Right: 'Right',
          Justify: 'Justify',
          Attach: 'Attach',
          action: 'Mensagens r√°pidas',
        };
      },
    },
  },

  data() {
    return {
      initialContent: '',

      attachmentOptionsOpen: false,
    };
  },

  created() {
    this.initialContent = this.value;
  },

  methods: {
    formatDoc(sCmd, sValue) {
      this.$refs.oDoc.focus();
      document.execCommand(sCmd, false, sValue);
      this.$refs.oDoc.focus();
    },

    validateMode() {
      return this.$refs.oDoc.focus();
    },

    onInput(event) {
      this.$emit('input', event.srcElement.innerHTML);
    },

    setValue(value) {
      this.$refs.oDoc.innerHTML = value;
      this.$emit('input', this.$refs.oDoc.innerHTML);
    },

    clear() {
      this.$refs.oDoc.innerHTML = '';
      this.$emit('input', this.$refs.oDoc.innerHTML);
    },

    text(key) {
      return this.texts[key];
    },
  },
};
</script>

<style lang="scss" scoped>
@import "../../assets/scss/unnnic.scss";

.unnnic-text-editor {
  display: grid;
  grid-template-areas:
    "text-editor actions"
    "format empty";
  grid-template-columns: 1fr auto;
  grid-column-gap: $unnnic-spacing-inline-xs;

  .text-editor {
    grid-area: text-editor;
    height: 7.25rem;
    box-sizing: border-box;
    overflow: auto;
    background-color: $unnnic-color-neutral-snow;
    border-radius: $unnnic-border-radius-sm;
    padding: $unnnic-spacing-inset-sm;
    border: $unnnic-border-width-thinner solid $unnnic-color-neutral-clean;
    outline: none;
    color: $unnnic-color-neutral-cloudy;
    font-family: $unnnic-font-family-secondary;
    font-size: $unnnic-font-size-body-gt;
    line-height: $unnnic-font-size-body-gt + $unnnic-line-height-md;
    font-weight: $unnnic-font-weight-regular;
    cursor: text;
    display: flex;
    flex-direction: column;

    .inside {
      flex: 1;
      outline: none;
    }

    .footer-input {
      margin-top: $unnnic-spacing-stack-xs;
      align-self: flex-start;
      cursor: initial;
    }

    p {
      margin: 0;
    }
  }

  .actions {
    grid-area: actions;
    display: flex;
    flex-direction: column;
    gap: $unnnic-spacing-stack-xs;
    place-self: center;
  }

  .format {
    grid-area: format;
    place-self: center;
    padding: $unnnic-spacing-inset-nano;
    user-select: none;
    display: flex;
    gap: $unnnic-spacing-inline-xs;

    .attachment-options-dropdown ::v-deep .unnnic-dropdown__content {
      padding: 0;
      bottom: 100%;
      margin-bottom: 0.5rem;
      right: (-10.375rem / 2) + 0.625rem;
    }

    .attachment-options-container {
      width: 10.375rem;
    }
  }
}
</style>
